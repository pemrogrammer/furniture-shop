{"version":3,"sources":["../../src/middlewares/auth.middleware.ts"],"sourcesContent":["import { NextFunction, Response } from 'express';\r\nimport { verify } from 'jsonwebtoken';\r\nimport { SECRET_KEY } from '@config';\r\nimport DB from '@databases';\r\nimport { HttpException } from '@exceptions/HttpException';\r\nimport { DataStoredInToken, RequestWithUser } from '@interfaces/auth.interface';\r\n\r\nconst authMiddleware = async (req: RequestWithUser, res: Response, next: NextFunction) => {\r\n  try {\r\n    const Authorization = req.cookies['Authorization'] || (req.header('Authorization') ? req.header('Authorization').split('Bearer ')[1] : null);\r\n\r\n    if (Authorization) {\r\n      const secretKey: string = SECRET_KEY;\r\n      const verificationResponse = verify(Authorization, secretKey) as DataStoredInToken;\r\n      const userId = verificationResponse.id;\r\n      const findUser = await DB.Users.findByPk(userId);\r\n\r\n      if (findUser) {\r\n        req.user = findUser;\r\n        next();\r\n      } else {\r\n        next(new HttpException(401, 'Wrong authentication token'));\r\n      }\r\n    } else {\r\n      next(new HttpException(404, 'Authentication token missing'));\r\n    }\r\n  } catch (error) {\r\n    next(new HttpException(401, 'Wrong authentication token'));\r\n  }\r\n};\r\n\r\nexport default authMiddleware;\r\n"],"names":["authMiddleware","req","res","next","Authorization","cookies","header","split","secretKey","SECRET_KEY","verificationResponse","verify","userId","id","findUser","DB","Users","findByPk","user","HttpException","error"],"mappings":"AAAA;;;;;AACuB,IAAA,aAAc,WAAd,cAAc,CAAA;AACV,IAAA,OAAS,WAAT,WAAS,CAAA;AACrB,IAAA,UAAY,kCAAZ,cAAY,EAAA;AACG,IAAA,cAA2B,WAA3B,6BAA2B,CAAA;;;;;;AAGzD,MAAMA,cAAc,GAAG,OAAOC,GAAoB,EAAEC,GAAa,EAAEC,IAAkB,GAAK;IACxF,IAAI;QACF,MAAMC,aAAa,GAAGH,GAAG,CAACI,OAAO,CAAC,eAAe,CAAC,IAAI,CAACJ,GAAG,CAACK,MAAM,CAAC,eAAe,CAAC,GAAGL,GAAG,CAACK,MAAM,CAAC,eAAe,CAAC,CAACC,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,AAAC;QAE7I,IAAIH,aAAa,EAAE;YACjB,MAAMI,SAAS,GAAWC,OAAU,WAAA,AAAC;YACrC,MAAMC,oBAAoB,GAAGC,CAAAA,GAAAA,aAAM,AAA0B,CAAA,OAA1B,CAACP,aAAa,EAAEI,SAAS,CAAC,AAAqB,AAAC;YACnF,MAAMI,MAAM,GAAGF,oBAAoB,CAACG,EAAE,AAAC;YACvC,MAAMC,QAAQ,GAAG,MAAMC,UAAE,QAAA,CAACC,KAAK,CAACC,QAAQ,CAACL,MAAM,CAAC,AAAC;YAEjD,IAAIE,QAAQ,EAAE;gBACZb,GAAG,CAACiB,IAAI,GAAGJ,QAAQ,CAAC;gBACpBX,IAAI,EAAE,CAAC;aACR,MAAM;gBACLA,IAAI,CAAC,IAAIgB,cAAa,cAAA,CAAC,GAAG,EAAE,4BAA4B,CAAC,CAAC,CAAC;aAC5D;SACF,MAAM;YACLhB,IAAI,CAAC,IAAIgB,cAAa,cAAA,CAAC,GAAG,EAAE,8BAA8B,CAAC,CAAC,CAAC;SAC9D;KACF,CAAC,OAAOC,KAAK,EAAE;QACdjB,IAAI,CAAC,IAAIgB,cAAa,cAAA,CAAC,GAAG,EAAE,4BAA4B,CAAC,CAAC,CAAC;KAC5D;CACF,AAAC;eAEanB,cAAc"}